---
import Layout from "$layouts/Layout.astro"
import { getUserRepos } from "$utils/github"

const owner = Astro.params.owner!

const token = Astro.cookies.get("access_token")?.value
if (!token) return Astro.redirect("/")

const userRepos = await getUserRepos(token)

let navItems = [{ name: owner, url: `/${owner}`, folder: true }]
---

<Layout title={owner}>
	<div class="flex flex-col">
		{
			navItems.map((item, index) => (
				<a
					href={item.url}
					class:list={{
						"font-medium": item.folder,
						"text-neutral-500": index != navItems.length - 1,
					}}
				>
					{item.name}
				</a>
			))
		}
	</div>
	<div class="flex flex-col">
		{
			userRepos.map((item) => (
				<a href={`/${item.owner.login}/${item.name}`}>
					{item.owner.login != owner && `${item.owner.login}/`}
					{item.name}
				</a>
			))
		}
		<div class="mt-4 text-neutral-500">
			<a
				href="https://github.com/apps/minimal-cms/installations/new"
				class="font-medium"
			>
				Configure access to private repositories
			</a>
		</div>
	</div>
</Layout>
